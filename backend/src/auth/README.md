# Auth Module

موديول المصادقة يوفّر تسجيل المستخدمين وتسجيل الدخول مع JWT، ويطبّق استراتيجية Passport للتحقق من الطلبات المحمية.

## المكوّنات الرئيسية
- `AuthModule`: يربط مخطط `User`, يهيّئ `PassportModule` باستراتيجية JWT الافتراضية، ويضبط `JwtModule` اعتماداً على إعدادات `jwt` من `ConfigService`.
- `AuthController`: يعرّف المسارات العامة (`POST /auth/register`, `POST /auth/login`) مع توثيق Swagger.
- `AuthService`: ينفّذ منطق التسجيل (التحقق من التكرار وتشفير كلمة السر) وتسجيل الدخول (التحقق من الاعتماديات وإرجاع JWT).
- `JwtStrategy`: استراتيجية Passport للتحقق من التوكن، تتأكد من وجود المستخدم في قاعدة البيانات وتعيد الحمولة (`sub`, `role`).
- DTOs (`RegisterDto`, `LoginDto`, `AuthResponseDto`): تعرّف هيكل البيانات والتحقق والردود الموثقة.

## المتطلبات
- اتصال MongoDB مع مخطط `User`.
- إعدادات `jwt` في ملف الإعداد (`secret`, `expiresIn`).
- تثبيت `bcryptjs` لتشفير كلمات المرور.
- تفعيل الديكوريتر `@Public()` للمسارات المفتوحة، بينما المسارات الأخرى تعتمد على `JwtAuthGuard`.

## التدفقات
1. **Register**  
   - يتأكد من عدم وجود اسم المستخدم أو البريد مسبقاً.  
   - يشفر كلمة المرور بـ bcrypt ويخزن المستخدم.  
   - يعيد رسالة نجاح فقط (لا يعيد التوكن مباشرة).

2. **Login**  
   - يبحث عن المستخدم ويقارن كلمة المرور.  
   - ينشئ توكن JWT يحتوي `sub` و `role` بمدة صلاحية مضبوطة.  
   - يعيد `AuthResponseDto` يتضمن التوكن والدور.

3. **JWT Validation**  
   - يتم استخراج التوكن من رأس Authorization.  
   - `JwtStrategy.validate` تتحقق من وجود المستخدم وتعيد الحمولة لتستخدمها الحراس (`JwtAuthGuard`, `RolesGuard`).

## التوسعة والاختبارات
- أضف مسارات مثل إعادة تعيين كلمة المرور أو تحديث الملف الشخصي بتوسيع الخدمة والكنترولر.
- ينصح باختبارات وحدة لخدمة المصادقة + اختبارات تكامل تغطي السيناريوهات (تسجيل، تسجيل دخول، توكن منتهي/مستخدم محذوف).

