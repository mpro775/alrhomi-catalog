# Categories Module

موديول الفئات يتيح إدارة الهيكل الهرمي للفئات في لوحة التحكم، بما في ذلك الإنشاء، التعديل، والحذف مع التحقق من علاقات الأبناء.

## المكوّنات
- `CategoriesModule`: يربط مخطط `Category` عبر `MongooseModule` ويصدّر الخدمة.
- `CategoriesController`: يعرض المسارات الإدارية `/admin/categories` (GET, POST, PUT, DELETE) محمية بـ `JwtAuthGuard`, `RolesGuard` ودور `admin`.
- `CategoriesService`: يحتوي منطق إدارة الفئات، التحقق من وجود الأبناء، ومنع التكرار أو العلاقات غير الصالحة.
- DTOs (`CreateCategoryDto`, `UpdateCategoryDto`): تعرّف بنية البيانات والتحقق المطلوب.

## التدفقات الأساسية
1. **عرض الفئات**  
   - `GET /admin/categories` يعيد قائمة مرتّبة مع تحميل جزئي لمعلومات الأب (`parent`).
2. **إنشاء فئة**  
   - يتحقق من عدم تكرار الاسم.  
   - ي validates parent إذا تم تمريره (وجوده وصحة ObjectId).  
   - ينشئ الفئة ويعيدها بعد `populate`.
3. **تحديث فئة**  
   - يتحقق من صحة المعرّف.  
   - يتيح تحديث الاسم/الوصف/الأب ويمنع أن تكون الفئة أباً لنفسها.  
   - يتحقق من وجود الأب الجديد إن وجد.
4. **حذف فئة**  
   - يرفض الحذف في حال وجود فئات فرعية مرتبطة.  
   - يحذف الفئة وإلا يرمي `NotFoundException`.

## المتطلبات
- اتصال MongoDB مع مخطط `Category`.
- حماية المسارات بحراس JWT والأدوار.

## التوسعة والاختبارات
- يمكن إضافة دعم للترتيب المتعدد المستويات أو إرجاع شجرة كاملة عبر توسيع الخدمة.
- ينصح باختبارات وحدة للخدمة للتحقق من السيناريوهات (تكرار الاسم، حذف مع أبناء، تحديث الأب).

