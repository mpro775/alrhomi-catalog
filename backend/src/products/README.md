# Products Module

موديول المنتجات يدير دورة حياة المنتج (إنشاء، تحديث، حذف، واستعلام) مع ربطه بالفئات والصور ويدعم التصفية والترقيم عبر API محمية بـ JWT.

## المكونات
- `ProductsModule`: يربط مخططي `Product` و `Image` عبر `MongooseModule` ويصدّر الخدمة.
- `ProductsController`: مسارات `/products` تغطي:
  - `GET /products` مع `ProductQueryDto` للتصفية والترقيم.
  - `GET /products/:id` لعرض التفاصيل الكاملة (بما في ذلك الصور).
  - `POST /products`, `PUT /products/:id`, `DELETE /products/:id` لعمليات CRUD. جميعها محمية بـ `JwtAuthGuard`.
- `ProductsService`: ينفّذ منطق العمل، مثل منع التكرار، التحقق من المعرّفات، احتساب عدد الصور المرتبطة، ومنع حذف منتج مرتبط بصور.
- DTOs (`CreateProductDto`, `UpdateProductDto`, `ProductQueryDto`): تصف بنية البيانات، التحقق، وإعدادات التصفية.

## التدفقات الأساسية
1. **الاستعلام عن المنتجات**  
   - يدعم البحث النصي `q`, فلترة `category`, `model`, وترقيم النتائج (`page`, `limit`).  
   - يعيد بيانات المنتج مع اسم الفئة/الفرعية وعدد الصور.

2. **عرض منتج مفرد**  
   - يتحقق من صلاحية المعرّف.  
   - يجلب المنتج مع الفئات والـ images المرتبطة مع ترتيب تنازلي حسب تاريخ الإنشاء.

3. **إنشاء منتج**  
   - يتحقق من صحة معرفات الفئات.  
   - يتطلب رقم منتج `productCode` فريد ويخزن وصفًا اختياريًا ومتغيرات منظمة (اسم + قيم).  
   - يعالج أخطاء التكرار (Mongo error code 11000).

4. **تحديث منتج**  
   - يسمح بتعديل أي حقل اختياري مع التحقق من المعرفات.  
   - يعيد المنتج المحدث.

5. **حذف منتج**  
   - يرفض الحذف إن كان للمنتج صور مرتبطة، ويعيد عدد الصور لتوضيح السبب.  
   - يحذف المنتج عند عدم وجود صور ويعيد رسالة نجاح.

## المتطلبات
- اتصال MongoDB بمخططات `Product` و `Image`.
- تفعيل `JwtAuthGuard` للمسارات.
- وجود علاقات `category`/`subcategory` مع مخططات الفئات.

## التوسعة والاختبارات
- يمكن إضافة دعم للبحث المتقدم (مدى السعر، حالة المخزون) أو الربط مع وحدات أخرى مثل المخزون أو التحليلات.
- يُنصح باختبارات وحدة/تكامل تغطي سيناريوهات التكرار، التحديث الجزئي، وحالات الحذف مع/بدون صور.

